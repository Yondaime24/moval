class Moval{static openInstances=[];static minimizedInstances=[];static baseZ=1e3;constructor(t){this.$modal=$(t),this.$header=this.$modal.find(".moval-header"),this.$closeBtn=this.$modal.find(".close-btn"),this.$minBtn=this.$modal.find(".min-btn"),this.dragging=!1,this.offsetX=0,this.offsetY=0,this.minimized=!1,this.manualPosition=null,this.widthWhenOpen=null,this.initDrag(),this.$closeBtn.on("click",(t=>{t.stopPropagation(),this.close()})),this.$minBtn.on("click",(t=>{t.stopPropagation(),this.toggleMinimize()})),this.$modal.on("click",(t=>{this.minimized&&!$(t.target).closest(".min-btn, .close-btn").length&&this.toggleMinimize()}))}open({width:t="500px"}={}){const i=this.$header.data("header-color")||"#333";this.$header.css("background-color",i),Moval.removeFromArrays(this),this.widthWhenOpen=t,Moval.openInstances.push(this),this.minimized=!1,this.$modal.find(".moval-content").show(),this.$modal.fadeIn(120),Moval.layoutOpen(),Moval.layoutMinimized()}close(){this.$modal.fadeOut(120,(()=>{this.$modal.find(".moval-content").show(),this.minimized=!1,Moval.removeFromArrays(this),Moval.layoutOpen(),Moval.layoutMinimized()}))}toggleMinimize(){this.minimized?(Moval.removeFromArrays(this),Moval.openInstances.push(this),this.$modal.find(".moval-content").show(),this.minimized=!1,Moval.layoutOpen(),Moval.layoutMinimized()):(Moval.removeFromArrays(this),Moval.minimizedInstances.push(this),this.$modal.find(".moval-content").hide(),this.minimized=!0,Moval.layoutOpen(),Moval.layoutMinimized())}initDrag(){this.$header.on("mousedown",(t=>{if($(t.target).is(".close-btn, .min-btn"))return;if(this.minimized)return;this.dragging=!0;const i=this.$modal[0].getBoundingClientRect();this.$modal.css({top:i.top+"px",left:i.left+"px",transform:"none"}),this.offsetX=t.clientX-i.left,this.offsetY=t.clientY-i.top,this.$header.addClass("dragging"),t.preventDefault()})),$(document).on("mousemove.moval",(t=>{if(!this.dragging)return;let i=t.clientX-this.offsetX,o=t.clientY-this.offsetY;const n=this.$modal.outerWidth(),e=this.$header.outerHeight(),s=$(window).width(),a=$(window).height();i=Math.max(0,Math.min(i,s-n)),o=Math.max(0,Math.min(o,a-e)),this.$modal.css({left:i+"px",top:o+"px"})})),$(document).on("mouseup.moval",(()=>{if(!this.dragging)return;this.dragging=!1,this.$header.removeClass("dragging");const t=this.$modal.css("left"),i=this.$modal.css("top");this.manualPosition={left:t,top:i},Moval.layoutOpen(),Moval.layoutMinimized()}))}static removeFromArrays(t){let i=Moval.openInstances.indexOf(t);-1!==i&&Moval.openInstances.splice(i,1),i=Moval.minimizedInstances.indexOf(t),-1!==i&&Moval.minimizedInstances.splice(i,1)}static layoutOpen(){for(let t=0;t<Moval.openInstances.length;t++){const i=Moval.openInstances[t];if(i.manualPosition)i.$modal.css({top:i.manualPosition.top,left:i.manualPosition.left,transform:"none",right:"auto",bottom:"auto",zIndex:Moval.baseZ+10+t,width:i.widthWhenOpen||i.$modal.css("width"),height:"auto"});else{const o=30*t;i.$modal.css({top:`calc(50% + ${o}px)`,left:`calc(50% + ${o}px)`,transform:"translate(-50%, -50%)",right:"auto",bottom:"auto",zIndex:Moval.baseZ+10+t,width:i.widthWhenOpen||i.$modal.css("width"),height:"auto"})}i.$modal.find(".moval-content").show(),i.minimized=!1}}static layoutMinimized(){for(let t=0;t<Moval.minimizedInstances.length;t++){const i=Moval.minimizedInstances[t];i.$modal.css({top:"auto",left:"auto",right:10+260*t+"px",bottom:"10px",width:"250px",height:"40px",transform:"none",zIndex:Moval.baseZ+2e3+t}),i.$modal.find(".moval-content").hide(),i.minimized=!0}}}